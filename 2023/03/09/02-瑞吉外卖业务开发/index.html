<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"spy955.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="......">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞吉外卖业务开发">
<meta property="og:url" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Spy&#39;s blog">
<meta property="og:description" content="......">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/Users/14196/AppData/Roaming/Typora/typora-user-images/image-20230123140811366.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123173548664.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123180748033.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123194008116.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125132329672.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125164551217.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125195900606.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125203559231.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125205356535.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125212245948.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125212314603.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125215406966.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125220055996.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126110213751.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126123438845.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126124701898.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126125548360.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126130523328.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126152756607.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126163935398.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126182034964.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126203013968.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127081707368.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127085329971.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127085750838.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127102946081.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127103723887.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127204123515.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128101150436.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128101234984.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128181306151.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128202347907.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129082947113.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129094615009.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129105125929.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129105944178.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230202164857980.png">
<meta property="og:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230202164654592.png">
<meta property="article:published_time" content="2023-03-09T05:16:00.000Z">
<meta property="article:modified_time" content="2023-03-13T08:25:49.944Z">
<meta property="article:author" content="Sun Peiyuan">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/Users/14196/AppData/Roaming/Typora/typora-user-images/image-20230123140811366.png">


<link rel="canonical" href="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/","path":"2023/03/09/02-瑞吉外卖业务开发/","title":"瑞吉外卖业务开发"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>瑞吉外卖业务开发 | Spy's blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <!-- 引入jQuery -->
  <script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
  <!-- 雪花特效 -->
  <script type="text/javascript" src="/js/snow.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Spy's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Fighting</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">



    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">业务开发——员工管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.1.</span> <span class="nav-text">一、开发环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 数据库环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2Maven%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2Maven环境搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.2.</span> <span class="nav-text">二、后台系统登录和退出功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1后台登录功能开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">2.1.1需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">2.1.2代码开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">2.1.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2后台系统退出功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">2.2.1需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2.2.2代码开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">2.2.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%8C%E5%96%84"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3登录功能的完善</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">2.3.1问题分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">2.3.2代码实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">2.3.3功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.</span> <span class="nav-text">三、新增员工功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4功能测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5%E5%B0%8F%E7%BB%93"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.5小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="nav-number">1.4.</span> <span class="nav-text">四、员工信息分页查询功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%90%AF%E7%94%A8%E3%80%81%E7%A6%81%E7%94%A8%E5%91%98%E5%B7%A5%E8%B4%A6%E5%8F%B7"><span class="nav-number">1.5.</span> <span class="nav-text">五、启用、禁用员工账号</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3功能测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4%E4%BB%A3%E7%A0%81%E4%BF%AE%E5%A4%8D"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.4代码修复</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="nav-number">1.6.</span> <span class="nav-text">六、编辑员工信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.6.3.</span> <span class="nav-text">6.3功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">业务开发——分类管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="nav-number">2.1.</span> <span class="nav-text">一、公共字段自动填充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1问题分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.2代码实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">2.1.3.</span> <span class="nav-text">1.3功能测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="nav-number">2.1.4.</span> <span class="nav-text">1.4功能完善</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB"><span class="nav-number">2.2.</span> <span class="nav-text">二、新增分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">2.2.4.</span> <span class="nav-text">2.4功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.3.</span> <span class="nav-text">三、分类信息分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">2.3.1.</span> <span class="nav-text">3.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">2.3.2.</span> <span class="nav-text">3.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">2.3.3.</span> <span class="nav-text">3.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB"><span class="nav-number">2.4.</span> <span class="nav-text">四、删除分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">2.4.3.</span> <span class="nav-text">4.3功能测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="nav-number">2.4.4.</span> <span class="nav-text">4.4功能完善</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB"><span class="nav-number">2.5.</span> <span class="nav-text">五、修改分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">2.5.1.</span> <span class="nav-text">5.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">2.5.2.</span> <span class="nav-text">5.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">2.5.3.</span> <span class="nav-text">5.3功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">业务开发——菜品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD"><span class="nav-number">3.1.</span> <span class="nav-text">一、文件上传下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.1.</span> <span class="nav-text">1.1文件上传介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.2.</span> <span class="nav-text">1.2文件下载介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.1.3.</span> <span class="nav-text">1.3文件上传代码实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.1.4.</span> <span class="nav-text">1.4文件下载代码实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81"><span class="nav-number">3.2.</span> <span class="nav-text">二、新增菜品</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">2.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">2.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">3.2.4.</span> <span class="nav-text">2.4功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%8F%9C%E5%93%81%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5"><span class="nav-number">3.3.</span> <span class="nav-text">三、菜品信息分页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="nav-number">3.4.</span> <span class="nav-text">四、修改菜品</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">3.4.1.</span> <span class="nav-text">4.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="nav-number">3.4.2.</span> <span class="nav-text">4.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="nav-number">3.4.3.</span> <span class="nav-text">4.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%8F%9C%E5%93%81%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-number">3.5.</span> <span class="nav-text">五、菜品的删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">3.5.1.</span> <span class="nav-text">5.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="nav-number">3.5.2.</span> <span class="nav-text">5.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="nav-number">3.5.3.</span> <span class="nav-text">5.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E8%8F%9C%E5%93%81%E7%9A%84%E5%90%AF%E5%94%AE%E5%81%9C%E5%94%AE"><span class="nav-number">3.6.</span> <span class="nav-text">六、菜品的启售停售</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">3.6.1.</span> <span class="nav-text">6.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">3.6.2.</span> <span class="nav-text">6.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">3.6.3.</span> <span class="nav-text">6.3功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">业务开发——套餐管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="nav-number">4.1.</span> <span class="nav-text">一、新增套餐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">4.1.1.</span> <span class="nav-text">1.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">4.1.2.</span> <span class="nav-text">1.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">4.1.3.</span> <span class="nav-text">1.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">4.1.4.</span> <span class="nav-text">1.4功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.2.</span> <span class="nav-text">二、套餐信息分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="nav-number">4.2.1.</span> <span class="nav-text">2.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">4.2.2.</span> <span class="nav-text">2.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">4.2.3.</span> <span class="nav-text">2.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="nav-number">4.3.</span> <span class="nav-text">三、删除套餐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="nav-number">4.3.1.</span> <span class="nav-text">3.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="nav-number">4.3.2.</span> <span class="nav-text">3.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="nav-number">4.3.3.</span> <span class="nav-text">3.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%A5%97%E9%A4%90%E7%9A%84%E5%90%AF%E5%94%AE%E5%81%9C%E5%94%AE"><span class="nav-number">4.4.</span> <span class="nav-text">四、套餐的启售停售</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-3"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-3"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.3功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">业务开发——手机验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="nav-number">5.1.</span> <span class="nav-text">一、短信发送</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.1.1.</span> <span class="nav-text">1.1短信服务介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.1.2.</span> <span class="nav-text">1.2阿里云短信服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">5.1.3.</span> <span class="nav-text">1.3代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="nav-number">5.2.</span> <span class="nav-text">二、手机验证码登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="nav-number">5.2.1.</span> <span class="nav-text">2.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-2"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="nav-number">5.2.3.</span> <span class="nav-text">2.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="nav-number">5.2.4.</span> <span class="nav-text">2.4功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="nav-number">6.</span> <span class="nav-text">业务开发——移动端开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AF%BC%E5%85%A5%E7%94%A8%E6%88%B7%E5%9C%B0%E5%9D%80%E7%B0%BF"><span class="nav-number">6.1.</span> <span class="nav-text">一、导入用户地址簿</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="nav-number">6.1.1.</span> <span class="nav-text">1.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-1"><span class="nav-number">6.1.2.</span> <span class="nav-text">1.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E5%AF%BC%E5%85%A5%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="nav-number">6.1.3.</span> <span class="nav-text">1.3导入功能代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">6.1.4.</span> <span class="nav-text">1.4功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%8F%9C%E5%93%81%E5%B1%95%E7%A4%BA"><span class="nav-number">6.2.</span> <span class="nav-text">二、菜品展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="nav-number">6.2.1.</span> <span class="nav-text">2.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">6.2.2.</span> <span class="nav-text">2.2代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">6.2.3.</span> <span class="nav-text">2.3功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">6.3.</span> <span class="nav-text">三、购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="nav-number">6.3.1.</span> <span class="nav-text">3.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-1"><span class="nav-number">6.3.2.</span> <span class="nav-text">3.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="nav-number">6.3.3.</span> <span class="nav-text">3.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="nav-number">6.3.4.</span> <span class="nav-text">3.4功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="nav-number">6.4.</span> <span class="nav-text">四、用户下单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="nav-number">6.4.1.</span> <span class="nav-text">4.1需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.4.2.</span> <span class="nav-text">4.2数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-number">6.4.3.</span> <span class="nav-text">4.3代码开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">6.4.4.</span> <span class="nav-text">4.4功能测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BUG%E6%B1%87%E6%80%BB"><span class="nav-number">7.</span> <span class="nav-text">BUG汇总</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sun Peiyuan"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">Sun Peiyuan</p>
  <div class="site-description" itemprop="description">Scientific research freshman, Farming</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Spy955" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Spy955" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:sunpeiyuan666@gmail.com" title="E-Mail → mailto:sunpeiyuan666@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>




    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Sun Peiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Spy's blog">
      <meta itemprop="description" content="Scientific research freshman, Farming">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="瑞吉外卖业务开发 | Spy's blog">
      <meta itemprop="description" content="......">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          瑞吉外卖业务开发
        </h1>

        <div class="post-meta-container">

          <div class="post-meta">

  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-09 13:16:00" itemprop="dateCreated datePublished" datetime="2023-03-09T13:16:00+08:00">2023-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-13 16:25:49" itemprop="dateModified" datetime="2023-03-13T16:25:49+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>52k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>47 分钟</span>
    </span>
</div>

            <div class="post-description">......</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="业务开发——员工管理"><a href="#业务开发——员工管理" class="headerlink" title="业务开发——员工管理"></a>业务开发——员工管理</h1><h2 id="一、开发环境搭建"><a href="#一、开发环境搭建" class="headerlink" title="一、开发环境搭建"></a>一、开发环境搭建</h2><h3 id="1-1-数据库环境搭建"><a href="#1-1-数据库环境搭建" class="headerlink" title="1.1 数据库环境搭建"></a>1.1 数据库环境搭建</h3><p>运行<code>sql</code>文件导入需要的数据表</p>
<p>数据表：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/Users\14196\AppData\Roaming\Typora\typora-user-images\image-20230123140811366.png" alt="image-20230123140811366"></p>
<h3 id="1-2Maven环境搭建"><a href="#1-2Maven环境搭建" class="headerlink" title="1.2Maven环境搭建"></a>1.2Maven环境搭建</h3><ul>
<li>创建<code>Maven</code>项目，检查本地仓库、<code>jdk</code>版本配置是否正确</li>
<li>导入<code>pom</code>文件</li>
<li>编写启动类检查是否可以正常启动</li>
<li>导入前端页面，添加静态资源映射——导入后即可访问静态页面</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、后台系统登录和退出功能"><a href="#二、后台系统登录和退出功能" class="headerlink" title="二、后台系统登录和退出功能"></a>二、后台系统登录和退出功能</h2><h3 id="2-1后台登录功能开发"><a href="#2-1后台登录功能开发" class="headerlink" title="2.1后台登录功能开发"></a>2.1后台登录功能开发</h3><h4 id="2-1-1需求分析"><a href="#2-1-1需求分析" class="headerlink" title="2.1.1需求分析"></a>2.1.1需求分析</h4><p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123173548664.png" alt="image-20230123173548664"></p>
<ul>
<li>判断账号和密码是否与数据库中的数据相对应</li>
<li>相对应则登录成功，否则登录失败</li>
<li>前端页面分析</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123180748033.png" alt="image-20230123180748033"></p>
<h4 id="2-1-2代码开发"><a href="#2-1-2代码开发" class="headerlink" title="2.1.2代码开发"></a>2.1.2代码开发</h4><p>1）创建实体类Employee，和employee表进行映射</p>
<p>2）创建Controller、Service、Mapper</p>
<p>3）导入返回结果类R——此类是一个通用结果类，服务器响应的所有结果最终都会包装成此种类型返回给前端页面</p>
<ul>
<li>当响应成功时，返回data即为调用success函数的时候的参数，并且设置响应code为1</li>
<li>当响应失败时，返回msg即为调用error函数的时候的参数，并且设置响应code为0</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.spy.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用返回结果，服务端响应的数据最终都会封装成此对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//动态数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）编写后台登录处理代码，处理逻辑如下：</p>
<ul>
<li>将页面提交的密码进行<code>md5</code>加密处理</li>
<li>根据页面提交的用户名<code>username</code>查询数据库</li>
<li>未查询到则返回登录失败结果</li>
<li>密码对比不一致返回登录失败结果</li>
<li>查看员工状态，如果员工为已禁用状态，则返回员工已禁用的结果</li>
<li>登录成功，将员工id存入到session并返回登录成功结果</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230123194008116.png" alt="image-20230123194008116"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/employee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 员工登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.将页面提交的密码进行`md5`加密处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.根据页面提交的用户名`username`查询数据库</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername,employee.getUsername());</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.未查询到则返回登录失败结果</span></span><br><span class="line">        <span class="keyword">if</span> (emp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.密码对比不一致返回登录失败结果</span></span><br><span class="line">        <span class="keyword">if</span> (!emp.getPassword().equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;账号或者密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.查看员工状态，如果员工为已禁用状态，则返回员工已禁用的结果</span></span><br><span class="line">        <span class="keyword">if</span> (emp.getStatus() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;账号已禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.登录成功，将员工id存入到session并返回登录成功结果</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>,emp.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：<code>@RequestBody</code>就是将前端页面中收到的数据封装为<code>json</code>格式进行返回，使用<code>Employee</code>实体类来进行接收。</li>
<li>最终做返回的是数据库中查找出来的数据封装为<code>Employee</code>实体类</li>
</ul>
<h4 id="2-1-3功能测试"><a href="#2-1-3功能测试" class="headerlink" title="2.1.3功能测试"></a>2.1.3功能测试</h4><p>在页面上进行功能测试，测试三种情况是否都能有正常的响应</p>
<h3 id="2-2后台系统退出功能"><a href="#2-2后台系统退出功能" class="headerlink" title="2.2后台系统退出功能"></a>2.2后台系统退出功能</h3><h4 id="2-2-1需求分析"><a href="#2-2-1需求分析" class="headerlink" title="2.2.1需求分析"></a>2.2.1需求分析</h4><p>员工登录成功之后，页面跳转到后台系统首页面，此时会显示当前用户的姓名，如果员工需要退出系统，直接点击员工右侧的退出按钮即可退出系统，退出系统之后返回到登录页面。</p>
<h4 id="2-2-2代码开发"><a href="#2-2-2代码开发" class="headerlink" title="2.2.2代码开发"></a>2.2.2代码开发</h4><p><strong>代码思路：</strong></p>
<p>用户点击页面中的退出按钮，发送请求，请求地址为<code>/employee/logout</code>，请求方式为<code>POST</code>。我们只需要在<code>Controller</code>中创建对应的处理方法即可，具体的处理逻辑为：</p>
<ul>
<li>清理<code>Session</code>中的用户<code>id</code></li>
<li>返回结果</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//清理Session中保存的当前登录员工的id</span></span><br><span class="line">    request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3功能测试"><a href="#2-2-3功能测试" class="headerlink" title="2.2.3功能测试"></a>2.2.3功能测试</h4><p>测试退出功能</p>
<h3 id="2-3登录功能的完善"><a href="#2-3登录功能的完善" class="headerlink" title="2.3登录功能的完善"></a>2.3登录功能的完善</h3><h4 id="2-3-1问题分析"><a href="#2-3-1问题分析" class="headerlink" title="2.3.1问题分析"></a>2.3.1问题分析</h4><ul>
<li>前面已经初步实现了后台系统的员工登录功能的开发，但是还存在一个问题：用户如果不登录，直接访问系统页面的首页，照样可以进行跳转访问。</li>
<li>我们的目标是只有登录成功之后才会访问系统中的页面，如果没有访问，则自动跳转到登录页面。</li>
<li>具体实现：使用过滤器或者拦截器，在过滤器或者拦截器之中判断员工是否已经登录，若未登录则跳转到登录页面。</li>
</ul>
<h4 id="2-3-2代码实现"><a href="#2-3-2代码实现" class="headerlink" title="2.3.2代码实现"></a>2.3.2代码实现</h4><p>实现步骤：</p>
<ol>
<li>创建自定义过滤器<code>LoginCheckFilter</code></li>
<li>在启动类上加入注解<code>@ServletComponentScan</code></li>
<li>完善过滤器的处理逻辑</li>
</ol>
<p>过滤器处理逻辑如下：</p>
<ul>
<li>获取本次请求的URI</li>
<li>判断此次请求是否需要处理</li>
<li>如果不需要处理，则直接放行</li>
<li>判断登录状态，如果已经登录，则直接放行</li>
<li>如果未登录则返回未登录结果</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125132329672.png" alt="image-20230125132329672"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">//路径匹配器，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        <span class="comment">//1、获取本次请求的URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;拦截到请求：&#123;&#125;&quot;</span>,requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义不需要处理的请求路径</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、判断本次请求是否需要处理</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> check(urls, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、如果不需要处理，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;本次请求&#123;&#125;不需要处理&quot;</span>,requestURI);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        <span class="comment">//5、如果未登录则返回未登录结果，通过输出流方式向客户端页面响应数据</span></span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查路径匹配来判断是否放行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls, String requestURI)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span> (match)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>filterName</code>的首字母一定要小写！！！小写！！！小写！！！</li>
</ul>
<h4 id="2-3-3功能测试"><a href="#2-3-3功能测试" class="headerlink" title="2.3.3功能测试"></a>2.3.3功能测试</h4><p>测试拦截是否已经生效</p>
<h2 id="三、新增员工功能"><a href="#三、新增员工功能" class="headerlink" title="三、新增员工功能"></a>三、新增员工功能</h2><h3 id="3-1需求分析"><a href="#3-1需求分析" class="headerlink" title="3.1需求分析"></a>3.1需求分析</h3><p>后台系统中可以管理员工的信息，通过新增员工来添加后台系统用户。点击<code>[添加员工]</code>按钮跳转到新增页面，如下：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125164551217.png" alt="image-20230125164551217"></p>
<h3 id="3-2数据模型"><a href="#3-2数据模型" class="headerlink" title="3.2数据模型"></a>3.2数据模型</h3><p>新增员工，其实就是将新增页面录入的员工数据插入到employee表，需要注意的是，<code>employee</code>表中对<code>username</code>字段加入了唯一约束，因为<code>username</code>是员工的登录账号，必须是唯一的。</p>
<p><code>employee</code>表中的<code>Status</code>字段已经设置了默认值1，表示状态正常。</p>
<h3 id="3-3代码开发"><a href="#3-3代码开发" class="headerlink" title="3.3代码开发"></a>3.3代码开发</h3><p>在开发代码之前，需要梳理一下整个程序的执行过程：</p>
<ol>
<li>页面发送<code>ajax</code>请求，将新增员工页面中输入的数据以<code>json</code>的形式提交给服务端</li>
<li>服务端<code>Controller</code>接收页面提交的数据并且调用<code>Service</code>将数据进行保存</li>
<li><code>Service</code>调用<code>Mapper</code>操作数据库，保存数据</li>
</ol>
<p>初步实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增员工，员工信息：&#123;&#125;&quot;</span>,employee.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置初始密码123456,但是需要进行md5加密处理</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取当前登录用户的id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">        employee.setUpdateUser(empId);</span><br><span class="line">        employee.setCreateUser(empId);</span><br><span class="line"></span><br><span class="line">        employeeService.save(employee);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增员工成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此时存在一定的异常，当申请的账号在数据库中已经存在的时候，由于账号在设置该字段的时候加入了唯一性约束，因此程序会出现异常</p>
<blockquote>
<p>Duplicate entry ‘zhangsan’ for key ‘employee.idx_username’</p>
</blockquote>
</li>
<li><p>此时我们的程序需要进行异常捕获，通常有两种处理方式：</p>
<ol>
<li><p>在<code>Controller</code>方法中加入<code>try-catch</code>进行异常捕获</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    employeeService.save(employee);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">        String[] split = e.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> split[<span class="number">2</span>] + <span class="string">&quot;已存在&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> R.error(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用异常处理器进行全局异常捕获——项目采用此方式来进行异常捕获</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> spy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-01-25 17:22</span></span><br><span class="line"><span class="comment"> * 全局异常处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ControllerAdvice</span>中的参数表示拦截注解类型的且注解类型为以下两种的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> split[<span class="number">2</span>] + <span class="string">&quot;已存在&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> R.error(msg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;未知错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于异常信息：Duplicate entry ‘zhangsan’ for key ‘employee.idx_username’，采用上述split方法进行处理</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id="3-4功能测试"><a href="#3-4功能测试" class="headerlink" title="3.4功能测试"></a>3.4功能测试</h3><p>测试新增员工功能和异常处理功能</p>
<h3 id="3-5小结"><a href="#3-5小结" class="headerlink" title="3.5小结"></a>3.5小结</h3><ul>
<li>根据产品原型明确业务需求</li>
<li>重点分析数据的流转过程和数据格式</li>
<li>通过debug断点调试跟踪程序执行过程</li>
</ul>
<h2 id="四、员工信息分页查询功能"><a href="#四、员工信息分页查询功能" class="headerlink" title="四、员工信息分页查询功能"></a>四、员工信息分页查询功能</h2><h3 id="4-1需求分析"><a href="#4-1需求分析" class="headerlink" title="4.1需求分析"></a>4.1需求分析</h3><p>系统中的员工很多的时候，如果在一个页面上全部显示出来会显得比较乱，不便于查看，所以一般系统中都会以分页的方式来展示数据</p>
<h3 id="4-2代码开发"><a href="#4-2代码开发" class="headerlink" title="4.2代码开发"></a>4.2代码开发</h3><p>在开发代码之前，梳理整个程序执行的过程：</p>
<ol>
<li>页面发送<code>ajax</code>请求，将分页查询参数(<code>page</code>、<code>pageSize</code>、<code>name</code>)提交到服务端（前端已做）</li>
<li>服务端<code>Controller</code>接收页面提交的数据并调用<code>Service</code>查询数据</li>
<li><code>Service</code>调用<code>Mapper</code>操作数据库，查询分页数据</li>
<li><code>Controller</code>将查询到的分页数据响应给页面</li>
<li>页面接收到分页数据并通过<code>ElementUI</code>的<code>Table</code>组件展示到页面上</li>
</ol>
<p><strong>配置类加入分页插件：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> spy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-01-25 18:58</span></span><br><span class="line"><span class="comment"> * 配置MP的分页插件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>员工信息分页数据查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 员工信息分页数据查询</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> page 当前页码</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pageSize 一页所包含的数据</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> name 查询框里的查询条件</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;page=&#123;&#125;,pageSize=&#123;&#125;,name=&#123;&#125;&quot;</span>,page,pageSize,name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造分页构造器</span></span><br><span class="line">    <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page,pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//添加一个过滤条件</span></span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);</span><br><span class="line">    <span class="comment">//添加一个排序条件</span></span><br><span class="line">    queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行查询</span></span><br><span class="line">    employeeService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3功能测试"><a href="#4-3功能测试" class="headerlink" title="4.3功能测试"></a>4.3功能测试</h3><p>对员工分页功能进行测试</p>
<h2 id="五、启用、禁用员工账号"><a href="#五、启用、禁用员工账号" class="headerlink" title="五、启用、禁用员工账号"></a>五、启用、禁用员工账号</h2><h3 id="5-1需求分析"><a href="#5-1需求分析" class="headerlink" title="5.1需求分析"></a>5.1需求分析</h3><p>在员工管理列表页面，可以对某个员工账号进行启用或者禁用操作。账号禁用的员工不能登录系统，启用后的员工可以进行正常登录</p>
<p>可以注意，只有管理员（admin用户）可以对其他用户进行启用、禁用操作，所以普通用户登录系统之后启用、禁用按钮不显示</p>
<p>如果员工状态为启用，则按钮显示为 禁用；如果员工状态为禁用，则按钮显示为 启用</p>
<h3 id="5-2代码开发"><a href="#5-2代码开发" class="headerlink" title="5.2代码开发"></a>5.2代码开发</h3><ul>
<li><p>前端页面已经完成只有管理员可以显示启用、禁用操作按钮</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125195900606.png" alt="image-20230125195900606"></p>
</li>
<li><p>在开发代码之前，需要梳理一下整个程序的执行过程</p>
<ol>
<li>页面发送<code>ajax</code>请求，将参数(<code>id</code>、<code>status</code>)提交到服务端</li>
<li>服务端<code>Controller</code>接收页面提交的数据并调用<code>Service</code>更新数据</li>
<li><code>Service</code>调用<code>Mapper</code>操作数据库</li>
</ol>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125203559231.png" alt="image-20230125203559231"></p>
</li>
<li><p>页面发送<code>ajax</code>请求的方式</p>
</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125205356535.png" alt="image-20230125205356535"></p>
<ul>
<li>编写代码完成员工账号禁用及启用功能（和下面编辑员工信息代码一致）</li>
</ul>
<h3 id="5-3功能测试"><a href="#5-3功能测试" class="headerlink" title="5.3功能测试"></a>5.3功能测试</h3><p>进行功能测试，发现功能没有报错但是功能并没有实现，查看数据库可以发现数据库中的数据也没有变化</p>
<p>观察控制台给出的SQL：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125212245948.png" alt="image-20230125212245948"></p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125212314603.png" alt="image-20230125212314603"></p>
<p>可以发现<code>id</code>值并不相同，SQL更新的结果为0</p>
<p><strong>原因：</strong></p>
<p><code>js</code>对<code>long</code>型数据进行处理时丢失精度，导致提交的<code>id</code>和数据库中的<code>id</code>不一致</p>
<p><strong>解决办法：</strong></p>
<p>我们可以在服务端给页面响应<code>json</code>数据时进行处理，将<code>long</code>型数据统一成<code>String</code>字符串</p>
<h3 id="5-4代码修复"><a href="#5-4代码修复" class="headerlink" title="5.4代码修复"></a>5.4代码修复</h3><p><strong>具体实现步骤：</strong></p>
<ul>
<li><p>提供对象转换器<code>JacksonObjectMapper</code>，基于<code>]ackson</code>进行<code>Java</code>对象到<code>json</code>数据的转换(资料中已经提供，直接复制到项目中使用)</p>
</li>
<li><p>这个类不止此处需要用到，在后续编辑员工信息也要用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span></span><br><span class="line"><span class="comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span></span><br><span class="line"><span class="comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .addSerializer(BigInteger.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(Long.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>WebMvcConfig</code>配置类中扩展<code>Spring mvc</code>的消息转换器，在此消息转换器中使用提供的对象转换器进行<code>Java</code>对象到<code>json</code>数据的转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 扩展mvc框架的消息转换器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;扩展消息转换器...&quot;</span>);</span><br><span class="line">    <span class="comment">//创建消息转换器对象</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    <span class="comment">//设置对象转换器，底层使用Jackson将Java对象转为json</span></span><br><span class="line">    messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">    <span class="comment">//将上面的消息转换器对象追加到mvc框架的转换器集合中</span></span><br><span class="line">    converters.add(<span class="number">0</span>,messageConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="六、编辑员工信息"><a href="#六、编辑员工信息" class="headerlink" title="六、编辑员工信息"></a>六、编辑员工信息</h2><h3 id="6-1需求分析"><a href="#6-1需求分析" class="headerlink" title="6.1需求分析"></a>6.1需求分析</h3><p>在员工管理列表页面点击编辑按钮，跳转到编辑页面，在编辑页面回显员工信息并进行修改，最后点击保存按钮完成编辑操作</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125215406966.png" alt="image-20230125215406966"></p>
<h3 id="6-2代码开发"><a href="#6-2代码开发" class="headerlink" title="6.2代码开发"></a>6.2代码开发</h3><p>在开发代码之前需要梳理一下操作过程和对应的程序的执行流程:</p>
<ol>
<li>点击编辑按钮时，页面跳转到<code>add.html</code>，并在<code>url</code>中携带参数[员工<code>id</code>]</li>
<li>在<code>add.htm</code>[页面获取<code>url</code>中的参数[员工<code>id</code>]</li>
<li>发送<code>ajax</code>请求，请求服务端，同时提交员工<code>id</code>参数</li>
<li>服务端接收请求，根据员工<code>id</code>查询员工信息，将员工信息以<code>json</code>形式响应给页面</li>
<li>页面接收服务端响应的<code>json</code>数据，通过<code>VUE</code>的数据绑定进行员工信息回显</li>
<li>点击保存按钮，发送<code>ajax</code>请求，将页面中的员工信息以<code>json</code>方式提交给服务端</li>
<li>服务端接收员工信息，并进行处理，完成后给页面响应</li>
<li>页面接收到服务端响应信息后进行相应处理</li>
</ol>
<p><strong>注意:</strong> <code>add.html</code>页面为公共页面，新增员工和编辑员工都是在此页面操作</p>
<p><code>html</code>页面中相关的代码都已经提供好了，我们只需要分析页面发送的请求和需要的响应数据格式，就可以对应来创<br>建服务端的<code>Controller</code>方法<code>getByld</code>方法</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230125220055996.png" alt="image-20230125220055996"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 编辑员工信息功能，由于和添加员工信息为同一个页面操作，因此主要实现数据回显</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;根据id查询员工信息&quot;</span>);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="literal">null</span>) &#123;</span><br><span class="line">    	<span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;没有查询到对应员工信息&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">    employeeService.updateById(employee);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;员工信息修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3功能测试"><a href="#6-3功能测试" class="headerlink" title="6.3功能测试"></a>6.3功能测试</h3><p>测试数据回显功能是否实现</p>
<h1 id="业务开发——分类管理"><a href="#业务开发——分类管理" class="headerlink" title="业务开发——分类管理"></a>业务开发——分类管理</h1><h2 id="一、公共字段自动填充"><a href="#一、公共字段自动填充" class="headerlink" title="一、公共字段自动填充"></a>一、公共字段自动填充</h2><h3 id="1-1问题分析"><a href="#1-1问题分析" class="headerlink" title="1.1问题分析"></a>1.1问题分析</h3><p>前面已经完成后台系统员工管理功能的实现，在新增员工的时候需要设置创建时间、创建人、修改时间、修改人等字段，在编辑员工的时候需要设置修改时间和修改人等字段。这些字段属于公共字段，也就是很多表中都有这些字段</p>
<p>是否可以通过对这些公共字段在某个地方进行统一处理，从而来简化开发？</p>
<p>答案就是可以使用<code>MyBatis Plus</code>提供的公共字段处理功能</p>
<h3 id="1-2代码实现"><a href="#1-2代码实现" class="headerlink" title="1.2代码实现"></a>1.2代码实现</h3><p><code>Mybatis Plus</code>公共字段自动填充，也就是在插入或者更新的时候为指定字段赋予指定的值，使用它的好处就是可以统一对这些字段进行处理，避免了重复代码。</p>
<p>实现步骤:</p>
<ol>
<li><p>在实体类的属性上加入<code>@TableField</code>注解，指定自动填充的策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">在Employee实体类中加入注解<span class="doctag">@TableField</span></span></span><br><span class="line"><span class="comment">FieldFill.INSERT：插入时进行更新</span></span><br><span class="line"><span class="comment">FieldFill.INSERT_UPDATE：插入和更新时都进行更新</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure>
</li>
<li><p>按照框架要求编写元数据对象处理器，在此类中统一为公共字段赋值，此类需要实现<code>MetaObjectHandler</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjecthandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入操作，自动填充</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;公共字段自动填充[insert]...&quot;</span>);</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>,<span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,<span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新操作，自动填充</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;公共字段自动填充[update]...&quot;</span>);</span><br><span class="line">        log.info(metaObject.toString());</span><br><span class="line"></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,<span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上述的代码实现了使用数据填充器进行自动填充，但是还有一个问题：需要动态获取当前用户的<code>id</code>来进行赋值</li>
</ul>
</li>
</ol>
<h3 id="1-3功能测试"><a href="#1-3功能测试" class="headerlink" title="1.3功能测试"></a>1.3功能测试</h3><p>通过测试可以发现，能够进行自动填充</p>
<h3 id="1-4功能完善"><a href="#1-4功能完善" class="headerlink" title="1.4功能完善"></a>1.4功能完善</h3><p>前面我们已经完成了公共字段自动填充功能的代码开发，但是还有一个问题没有解决，就是我们在自动填充<code>createUser</code>和<code>updateUser</code>时设置的用户<code>id</code>是固定值，现在我们需要改造成动态获取当前登录用户的<code>id</code>。</p>
<p>有的同学可能想到，用户登录成功后我们将用户<code>id</code>存入了<code>HttpSession</code>中，现在我从<code>HttpSession</code>中获取不就行了?</p>
<p>注意：我们在<code>MyMetaObjectHandler</code>类中是不能获得<code>HttpSession</code>对象的，所以我们需要通过其他方式来获取登录用户<code>id</code>。</p>
<p>可以使用<code>ThreadLocal</code>来解决此问题，它是<code>JDK</code>中提供的一个类。</p>
<blockquote>
<p>在学习<code>ThreadLocal</code>之前，我们需要先确认一个事情，就是客户端发送的每次<code>http</code>请求，对应的在服务端都会分配一个新的线程来处理，在处理过程中涉及到下面类中的方法都属于相同的一个线程:<br>1、<code>LoginCheckFilter</code>的<code>doFilter</code>方法<br>2、<code>EmployeeController</code>的<code>update</code>方法<br>3、<code>MyMetaObjectHandler</code>的<code>updateFill</code>方法<br>可以在上面的三个方法中分别加入下面代码 (获取当前线程id) :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">log.info(<span class="string">&quot;线程id:&#123;&#125;&quot;</span>,id);</span><br></pre></td></tr></table></figure>

<p>执行编辑员工功能进行验证，通过观察控制台输出可以发现，一次请求对应的线程<code>id</code>是相同的:</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126110213751.png" alt="image-20230126110213751"></p>
</blockquote>
<p>什么是<code>ThreadLocal</code>?<br><code>ThreadLocal</code>并不是一个<code>Thread</code>，而是<code>Thread</code>的局部变量。当使用<code>ThreadLocal</code>维护变量时，<code>ThreadLocal</code>为每个使用该变量的线程提供独立的变量副本，所以每一个线程都可以独立地改变自己的副本，而不会影响其它线程所对应的副本。<code>ThreadLocal</code>为每个线程提供单独一份存储空间，具有线程隔离的效果，只有在线程内才能获取到对应的值，线程外则不能访问。</p>
<p><strong><code>ThreadLocal</code>常用方法</strong></p>
<ul>
<li><code>public void set(T value)</code>:设置当前线程的线程局部变量的值</li>
<li><code>public T get()</code>:返回当前线程所对应的线程局部变量的值</li>
</ul>
<p>我们可以在<code>LoginCheckFilter</code>的<code>doFilter</code>方法中获取当前登录用户<code>id</code>，并调用<code>ThreadLocal</code>的<code>set</code>方法来设置当前线程的线程局部变量的值(用户<code>id</code>)，然后在<code>MyMeta0bjectHandler</code>的<code>updateFill</code>方法中调用<code>ThreadLocal</code>的<code>get</code>方法来获得当前线程所对应的线程局部变量的值(用户<code>id</code>)。</p>
<p><strong>实现步骤：</strong></p>
<ul>
<li>编写<code>BaseContext</code>工具类，基于<code>ThreadLocal</code>封装的工具类</li>
<li>在<code>LoginCheckFilter</code>的<code>doFilter</code>方法中调用<code>BaseContext</code>来设置当前登录用户的<code>id</code></li>
<li>在<code>MyMetaObjectHandler</code>的方法中调用<code>BaseContext</code>获取登录用户的<code>id</code></li>
</ul>
<p><code>BaseContext</code>工具类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基于ThreadLocal封装工具类，用户保存和获取当前登录用户id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>LoginCheckFilter</code>的<code>doFilter</code>方法中调用<code>BaseContext</code>来设置当前登录用户的<code>id</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">BaseContext.setCurrentId(empId);</span><br></pre></td></tr></table></figure>

<p>在<code>MyMetaObjectHandler</code>的方法中调用<code>BaseContext</code>获取登录用户的<code>id</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">metaObject.setValue(<span class="string">&quot;createUser&quot;</span>,BaseContext.getCurrentId());</span><br><span class="line">metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,BaseContext.getCurrentId());</span><br></pre></td></tr></table></figure>

<h2 id="二、新增分类"><a href="#二、新增分类" class="headerlink" title="二、新增分类"></a>二、新增分类</h2><h3 id="2-1需求分析"><a href="#2-1需求分析" class="headerlink" title="2.1需求分析"></a>2.1需求分析</h3><p>后台系统中可以管理分类信息，分类包括两种类型，分别是菜品分类和套餐分类。当我们在后台系统中添加菜品时需要选择一个菜品分类，当我们在后台系统中添加一个套餐时需要选择一个套餐分类，在移动端也会按照菜品分类和套餐分类来展示对应的菜品和套餐。</p>
<p>菜品分类和套餐分类如下：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126123438845.png" alt="image-20230126123438845"></p>
<h3 id="2-2数据模型"><a href="#2-2数据模型" class="headerlink" title="2.2数据模型"></a>2.2数据模型</h3><p>新增分类，其实就是将我们新增窗口录入的分类数据插入到<code>category</code>表中，其中表结构如下：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126124701898.png" alt="image-20230126124701898"></p>
<p>需要注意，<code>category</code>表中对<code>name</code>字段加入了唯一约束，保证分类的名称是唯一的：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126125548360.png" alt="image-20230126125548360"></p>
<h3 id="2-3代码开发"><a href="#2-3代码开发" class="headerlink" title="2.3代码开发"></a>2.3代码开发</h3><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好</p>
<ul>
<li>实体类<code>Category</code> (直接从课程资料中导入即可)</li>
<li><code>Mapper</code>接口<code>CategoryMapper</code></li>
<li>业务层接口<code>CategoryService</code></li>
<li>业务层实现类<code>CategoryServicelmpl</code></li>
<li>控制层<code>CategoryController</code></li>
</ul>
<p>在开发代码之前，需要梳理一下整个程序的执行过程</p>
<ul>
<li>页面(<code>backend/page/category/list.html</code>)发送<code>ajax</code>请求，将新增分类窗口输入的数据以<code>json</code>形式提交到服务端</li>
<li>服务端<code>Controller</code>接收页面提交的数据并调用<code>Service</code>将数据进行保存</li>
<li><code>Service</code>调用<code>Mapper</code>操作数据库，保存数据</li>
</ul>
<p>可以看到新增菜品分类和新增套餐分类请求的服务端地址和提交的<code>json</code>数据结构相同，所以服务端只需要提供一个方法统处理即可:</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126130523328.png" alt="image-20230126130523328"></p>
<ul>
<li>只有<code>type</code>的值不同</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;category:&#123;&#125;&quot;</span>,category);</span><br><span class="line">    categoryService.save(category);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增分类成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4功能测试"><a href="#2-4功能测试" class="headerlink" title="2.4功能测试"></a>2.4功能测试</h3><p>进行功能测试，测试是否可以正常导入以及重复数据是否可以进行全局异常处理</p>
<h2 id="三、分类信息分页查询"><a href="#三、分类信息分页查询" class="headerlink" title="三、分类信息分页查询"></a>三、分类信息分页查询</h2><h3 id="3-1需求分析-1"><a href="#3-1需求分析-1" class="headerlink" title="3.1需求分析"></a>3.1需求分析</h3><p>数据太多，全部放在同一个页面中会导致可读性差，因此引入分页插件进行分页展示</p>
<h3 id="3-2代码开发"><a href="#3-2代码开发" class="headerlink" title="3.2代码开发"></a>3.2代码开发</h3><p>在开发代码之前，需要梳理一下整个程序的执行过程</p>
<ol>
<li><p>页面发送<code>ajax</code>请求，将分页查询参数(<code>page</code>、<code>pageSize</code>)提交到服务端</p>
</li>
<li><p>服务端<code>Controller</code>接收页面提交的数据并调用<code>Service</code>查询数据</p>
</li>
<li><p><code>Service</code>调用<code>Mapper</code>操作数据库，查询分页数据</p>
</li>
<li><p><code>Controller</code>将查询到的分页数据响应给页面</p>
</li>
<li><p>页面接收到分页数据并通过<code>ElementUl</code>的<code>Table</code>组件展示到页面上</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126152756607.png" alt="image-20230126152756607"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 分页展示信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize)</span>&#123;</span><br><span class="line">    <span class="comment">//引入分页构造器</span></span><br><span class="line">    Page&lt;Category&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    <span class="comment">//构造条件查询器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//添加排序条件，根据sort进行排序</span></span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行分页查询</span></span><br><span class="line">    categoryService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3功能测试"><a href="#3-3功能测试" class="headerlink" title="3.3功能测试"></a>3.3功能测试</h3><p>测试分页功能是否已经完成</p>
<h2 id="四、删除分类"><a href="#四、删除分类" class="headerlink" title="四、删除分类"></a>四、删除分类</h2><h3 id="4-1需求分析-1"><a href="#4-1需求分析-1" class="headerlink" title="4.1需求分析"></a>4.1需求分析</h3><p>在分类管理页面，可以对某个分类进行删除。需要注意的是当分类关联了菜品或者套餐的时候，此分类不允许删除。</p>
<ul>
<li>这里的关联指的是：例如精品热菜中有菜品的话，不可以删除这个套餐；同理，在套餐中的菜品也不可以被删除</li>
</ul>
<h3 id="4-2代码开发-1"><a href="#4-2代码开发-1" class="headerlink" title="4.2代码开发"></a>4.2代码开发</h3><p>在开发代码之前，需要梳理一下整个程序的执行过程</p>
<ol>
<li><p>页面发送ajax请求，将参数(id)提交到服务端</p>
</li>
<li><p>服务端Controller接收页面提交的数据并调用Service删除数据</p>
</li>
<li><p>Service调用Mapper操作数据库</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126163935398.png" alt="image-20230126163935398"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除分类，id为：&#123;&#125;&quot;</span>,ids);</span><br><span class="line"></span><br><span class="line">    categoryService.removeById(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;分类信息删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3功能测试-1"><a href="#4-3功能测试-1" class="headerlink" title="4.3功能测试"></a>4.3功能测试</h3><p>测试删除功能是否可以成功实现</p>
<h3 id="4-4功能完善"><a href="#4-4功能完善" class="headerlink" title="4.4功能完善"></a>4.4功能完善</h3><p>前面我们已经实现了根据<code>id</code>删除分类的功能，但是并没有检查删除的分类是否关联了菜品或者套餐，所以我们需要进行功能完善。</p>
<p>要完善分类删除功能，需要先准备基础的类和接口:</p>
<ol>
<li>实体类<code>Dish</code>和<code>Setmeal</code> (从课程资料中复制即可)</li>
<li><code>Mapper</code>接口<code>DishMapper</code>和<code>SetmealMapper</code></li>
<li><code>Service</code>接口<code>DishService</code>和<code>SetmealService</code></li>
<li><code>Service</code>实现类<code>DishServicelmpl</code>和<code>SetmealServicelmpl</code></li>
</ol>
<p>在<code>CategoryServiceImpl</code>加入如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除分类，删除之前需要进行判断</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//添加查询条件，根据分类id进行查询</span></span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getCategoryId,id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> dishService.count(dishLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询当前分类是否关联了菜品，如果已经关联，抛出一个业务异常</span></span><br><span class="line">        <span class="keyword">if</span>(count1 &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//已经关联菜品，抛出一个业务异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了菜品，不能删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询当前分类是否关联了套餐，如果已经关联，抛出一个业务异常</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//添加查询条件，根据分类id进行查询</span></span><br><span class="line">        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId,id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> setmealService.count(setmealLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span>(count2 &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//已经关联套餐，抛出一个业务异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了套餐，不能删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//正常删除分类</span></span><br><span class="line">        <span class="built_in">super</span>.removeById(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建自定义异常<code>CustomException</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String message)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在全局异常模块加入如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异常处理方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(CustomException ex)</span>&#123;</span><br><span class="line">    log.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.error(ex.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、修改分类"><a href="#五、修改分类" class="headerlink" title="五、修改分类"></a>五、修改分类</h2><h3 id="5-1需求分析-1"><a href="#5-1需求分析-1" class="headerlink" title="5.1需求分析"></a>5.1需求分析</h3><p>在分类管理页面点击修改按钮，弹出修改窗口，在修改窗口进行数据回显并进行修改，最后点击确定按钮完成修改操作</p>
<ul>
<li>其中回显已经前端完成，只需要我们点击确定处理发送请求</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126182034964.png" alt="image-20230126182034964"></p>
<h3 id="5-2代码开发-1"><a href="#5-2代码开发-1" class="headerlink" title="5.2代码开发"></a>5.2代码开发</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 进行分类更新</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;更新分类为：&#123;&#125;&quot;</span>, category);</span><br><span class="line"></span><br><span class="line">    categoryService.updateById(category);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改分类信息成功&quot;</span>);        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3功能测试-1"><a href="#5-3功能测试-1" class="headerlink" title="5.3功能测试"></a>5.3功能测试</h3><h1 id="业务开发——菜品管理"><a href="#业务开发——菜品管理" class="headerlink" title="业务开发——菜品管理"></a>业务开发——菜品管理</h1><h2 id="一、文件上传下载"><a href="#一、文件上传下载" class="headerlink" title="一、文件上传下载"></a>一、文件上传下载</h2><h3 id="1-1文件上传介绍"><a href="#1-1文件上传介绍" class="headerlink" title="1.1文件上传介绍"></a>1.1文件上传介绍</h3><p>文件上传，也称为upload，是指将本地图片、视频、音频等文件上传到服务器上，可以供其他用户浏览或下载的过程。</p>
<p>文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</p>
<p>文件上传时，对页面的form表单有如下要求:</p>
<ul>
<li><code>method=&quot;post&quot;</code>                                   采用<code>post</code>方式提交数据</li>
<li><code>enctype=&quot;multipart/form-data&quot; </code> 采用<code>multipart</code>格式上传文件</li>
<li><code>type=&quot;file&quot;</code>                                       使用<code>input</code>的<code>file</code>控件上传</li>
</ul>
<p><strong>举例</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/common/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;myFile&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file”/&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">	&lt;input type=&quot;</span><span class="attr">submit</span>&quot; <span class="attr">value</span>=<span class="string">&quot;提交”/&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">&lt;/form&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>服务端要接收客户端页面上传的文件，通常都会使用<code>Apache</code>的两个组件：</p>
<ul>
<li><code>commons-fileupload</code></li>
<li><code>commons-io</code></li>
</ul>
<p>Spring框架在spring-web包中对文件上传进行了封装，大大简化了服务端代码，我们只需要在Controller的方法中声明一个<code>MultipartFile</code>类型的参数即可接收上传的文件，例如：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230126203013968.png" alt="image-20230126203013968"></p>
<h3 id="1-2文件下载介绍"><a href="#1-2文件下载介绍" class="headerlink" title="1.2文件下载介绍"></a>1.2文件下载介绍</h3><p>文件下载，也称为<code>download</code>，是指将文件从服务器传输到本地计算机的过程。</p>
<p>通过浏览器进行文件下载，通常有两种表现形式：</p>
<ul>
<li>以附件形式下载，弹出保存对话框，将文件保存到指定磁盘目录</li>
<li>直接在浏览器中打开</li>
</ul>
<p>通过浏览器进行文件下载，本质上就是服务端将文件以流的形式写回浏览器的过程</p>
<h3 id="1-3文件上传代码实现"><a href="#1-3文件上传代码实现" class="headerlink" title="1.3文件上传代码实现"></a>1.3文件上传代码实现</h3><p>文件上传，页面端可以使用<code>ElementUl</code>提供的上传组件。</p>
<p>可以直接使用资料中提供的上传页面，位置：资料&#x2F;文件上传下载页面&#x2F;upload.html</p>
<ul>
<li>在配置文件中配置上传地址</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reggie:</span><br><span class="line">  path: D:\</span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>CommonController</code>中代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String basePath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 文件上传</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> file 名字一定要和前端中的name保持一致，否则无法获取文件</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">    <span class="comment">//file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除</span></span><br><span class="line">    log.info(file.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原始文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用UUID重新生成文件名，防止文件名重复导致文件覆盖</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个目录对象</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(basePath);</span><br><span class="line">    <span class="comment">//判断当前目录是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (!dir.exists())&#123;</span><br><span class="line">        <span class="comment">//目录不存在</span></span><br><span class="line">        dir.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//将临时文件转存到指定位置</span></span><br><span class="line">        file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(basePath + fileName));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    	e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-4文件下载代码实现"><a href="#1-4文件下载代码实现" class="headerlink" title="1.4文件下载代码实现"></a>1.4文件下载代码实现</h3><p>上面实现了文件上传，传到一个指定位置，现在要实现文件的下载，将刚刚上传的图片在页面中展示出来</p>
<p>文件下载，页面端可以使用<img>标签展示下载的图片</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127081707368.png" alt="image-20230127081707368"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 文件下载</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse response)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//输入流，通过输入流读取文件内容</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(basePath + name));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出流，通过输出流将文件写回浏览器</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line"></span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            outputStream.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        outputStream.close();</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    	e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、新增菜品"><a href="#二、新增菜品" class="headerlink" title="二、新增菜品"></a>二、新增菜品</h2><h3 id="2-1需求分析-1"><a href="#2-1需求分析-1" class="headerlink" title="2.1需求分析"></a>2.1需求分析</h3><p>后台系统中可以管理菜品信息，通过新增功能来添加一个新的菜品，在添加菜品时需要选择当前菜品所属的菜品分类，并且需要上传菜品图片，在移动端会按照菜品分类来展示对应的菜品信息。</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127085329971.png" alt="image-20230127085329971"></p>
<h3 id="2-2数据模型-1"><a href="#2-2数据模型-1" class="headerlink" title="2.2数据模型"></a>2.2数据模型</h3><p>新增菜品，其实就是将新增页面录入的菜品信息插入到<code>dish</code>表，如果添加了口味做法，还需要向<code>dish_flavor</code>表插入数据所以在新增菜</p>
<p>品时，涉及到两个表:</p>
<ul>
<li>dish                菜品表</li>
<li>dish flavor    菜品口味表</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127085750838.png" alt="image-20230127085750838"></p>
<h3 id="2-3代码开发-1"><a href="#2-3代码开发-1" class="headerlink" title="2.3代码开发"></a>2.3代码开发</h3><p><strong>准备工作</strong></p>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好</p>
<ul>
<li>实体类 <code>DishFlavor</code>(直接从课程资料中导入即可，<code>Dish</code>实体前面课程中已经导入过了)</li>
<li><code>Mapper</code>接口<code>DishFlavorMapper</code></li>
<li>业务层接口 <code>DishFlavorService</code></li>
<li>业务层实现类 <code>DishFlavorServicelmpl</code></li>
<li>控制层 <code>DishController</code></li>
</ul>
<p><strong>首先将上述准备工作完成，然后梳理交互过程</strong></p>
<p>在开发代码之前，需要梳理一下新增菜品时前端页面和服务端的交互过程</p>
<ol>
<li>页面(backend&#x2F;page&#x2F;food&#x2F;add.html)发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中</li>
<li>页面发送请求进行图片上传，请求服务端将图片保存到服务器</li>
<li>页面发送请求进行图片下载，将上传的图片进行回显</li>
<li>点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端</li>
</ol>
<p>开发新增菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可</p>
<ul>
<li>页面(backend&#x2F;page&#x2F;food&#x2F;add.html)发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据条件查询分类数据</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Category category)</span> &#123;</span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//添加条件</span></span><br><span class="line">    queryWrapper.eq(category.getType() != <span class="literal">null</span>,Category::getType,category.getType());</span><br><span class="line">    <span class="comment">//添加排序条件</span></span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>其中2、3步已经在文件上传和下载模块进行处理</p>
</li>
<li><p>点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端</p>
<p><strong>注意：</strong>在点击保存按钮之后，页面封装的数据，在<code>dish</code>实体类中并没有<code>flavor</code>属性，因此需要导入一个新的实体类（<code>DishDto</code>）来用于封装页面提交的数据</p>
<p>DTO：全程Data Transfer Object，即数据传输对象，一般用于展示层与服务层之间的数据传输。</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127102946081.png" alt="image-20230127102946081"></p>
</li>
</ul>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127103723887.png" alt="image-20230127103723887"></p>
<p>代码实现：</p>
<p><code>DishService</code>接口中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增菜品，同时插入菜品对应的口味数据，需要同时操作两张表dish、dish_flavor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br></pre></td></tr></table></figure>

<p><code>DishServiceImpl</code>实现类中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 新增菜品同时保存对应口味信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">//加入事务注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    <span class="comment">//保存菜品的基本信息到菜品表dish</span></span><br><span class="line">    <span class="built_in">this</span>.save(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();<span class="comment">//菜品id</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品口味</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line">    flavors = flavors.stream().map((item) -&gt; &#123;</span><br><span class="line">        item.setDishId(dishId);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存菜品口味数据到菜品口味表dish_flavor</span></span><br><span class="line">    dishFlavorService.saveBatch(flavors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在启动类加入启动事务注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4功能测试-1"><a href="#2-4功能测试-1" class="headerlink" title="2.4功能测试"></a>2.4功能测试</h3><p>测试数据表是否进行正常插入功能</p>
<h2 id="三、菜品信息分页"><a href="#三、菜品信息分页" class="headerlink" title="三、菜品信息分页"></a>三、菜品信息分页</h2><h3 id="3-1需求分析-2"><a href="#3-1需求分析-2" class="headerlink" title="3.1需求分析"></a>3.1需求分析</h3><p>系统中菜品信息较多，如果在一个页面中进行展示会比较乱，因此采用分页的方式来进行列表数据。</p>
<h3 id="3-2代码开发-1"><a href="#3-2代码开发-1" class="headerlink" title="3.2代码开发"></a>3.2代码开发</h3><p>在开发代码之前，需要梳理一下菜品分页查询时前端页面和服务端的交互过程</p>
<ol>
<li>页面(backend&#x2F;page&#x2F;food&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据</li>
<li>页面发送请求，请求服务端进行图片下载，用于页面图片展示</li>
</ol>
<p>开发菜品信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 菜品信息分页</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//构造分页构造器对象</span></span><br><span class="line">       Page&lt;Dish&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">       Page&lt;DishDto&gt; dishDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//条件构造器</span></span><br><span class="line">       LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//添加过滤条件</span></span><br><span class="line">       queryWrapper.like(name != <span class="literal">null</span>,Dish::getName,name);</span><br><span class="line">       <span class="comment">//添加排序条件</span></span><br><span class="line">       queryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//执行分页查询</span></span><br><span class="line">       dishService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//对象拷贝</span></span><br><span class="line">       BeanUtils.copyProperties(pageInfo,dishDtoPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">       List&lt;Dish&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">       List&lt;DishDto&gt; list = records.stream().map((item) -&gt; &#123;</span><br><span class="line">           <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">           BeanUtils.copyProperties(item,dishDto);</span><br><span class="line"></span><br><span class="line">           <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();<span class="comment">//分类id</span></span><br><span class="line">           <span class="comment">//根据id查询分类对象</span></span><br><span class="line">           <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>(category != <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">               dishDto.setCategoryName(categoryName);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> dishDto;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       dishDtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(dishDtoPage);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在菜品分页代码开发中，如果只是将返回数据封装为一个Dish对象，那么会导致菜品分类项无法显示。因此进行上述操作将其拷贝到<code>DishDto</code>中再设置其分类即可</li>
</ul>
<h3 id="3-3功能测试-1"><a href="#3-3功能测试-1" class="headerlink" title="3.3功能测试"></a>3.3功能测试</h3><p>测试分页功能是否可以正常展示</p>
<h2 id="四、修改菜品"><a href="#四、修改菜品" class="headerlink" title="四、修改菜品"></a>四、修改菜品</h2><h3 id="4-1需求分析-2"><a href="#4-1需求分析-2" class="headerlink" title="4.1需求分析"></a>4.1需求分析</h3><p>在菜品管理列表页面点击修改操作，跳转到修改菜品页面，在修改页面回显菜品相关信息并进行修改，最后点击确定按钮完成修改操作</p>
<h3 id="4-2代码开发-2"><a href="#4-2代码开发-2" class="headerlink" title="4.2代码开发"></a>4.2代码开发</h3><p>在开发代码之前，需要梳理一下修改菜品时前端页面 (add.html) 和服务端的交互过程</p>
<ol>
<li>页面发送ajax请求，请求服务端获取分类数据，用于菜品分类下拉框中数据展示（前面已经实现）</li>
<li>页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显</li>
<li>页面发送请求，请求服务端进行图片下载，用于页图片回显</li>
<li>点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端</li>
</ol>
<p>开发修改菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可</p>
<p><strong>注意</strong>：其中第一步和第三步已经实现，只要实现第二步和第四步即可</p>
<p>② 页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显</p>
<ul>
<li><p>首先在Service层编写接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询菜品信息和口味信息</span></span><br><span class="line"><span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在ServiceImpl编写接口函数的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询菜品基本信息，从dish表进行查询</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">    BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询当前菜品的口味信息，从dish_flavor表查询</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(DishFlavor::getDishId,dish.getId());</span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishFlavorService.list(queryWrapper);</span><br><span class="line">    dishDto.setFlavors(flavors);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dishDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Controller层编写控制层函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id查询菜品的信息和口味信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;DishDto&gt; <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">    <span class="keyword">return</span> R.success(dishDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>④ 点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端</p>
<p>在Controller层插入代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 修改菜品</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">    dishService.updateWithFlavor(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改菜品成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Service层编写函数<code>updateWithFlavor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新菜品信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    <span class="comment">//更新dish表基本信息</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先清理当前菜品对应的口味数据——dish_flavor表的delete操作</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(DishFlavor::getDishId,dishDto.getId());</span><br><span class="line"></span><br><span class="line">    dishFlavorService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加当前提交过来的口味数据——dish_flavor表的insert操作</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line"></span><br><span class="line">    flavors = flavors.stream().map((item) -&gt; &#123;</span><br><span class="line">        item.setDishId(dishDto.getId());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    dishFlavorService.saveBatch(flavors);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-3功能测试-2"><a href="#4-3功能测试-2" class="headerlink" title="4.3功能测试"></a>4.3功能测试</h3><p>进行功能测试</p>
<h2 id="五、菜品的删除"><a href="#五、菜品的删除" class="headerlink" title="五、菜品的删除"></a>五、菜品的删除</h2><h3 id="5-1需求分析-2"><a href="#5-1需求分析-2" class="headerlink" title="5.1需求分析"></a>5.1需求分析</h3><p>菜品的删除包括删除和批量删除</p>
<h3 id="5-2代码开发-2"><a href="#5-2代码开发-2" class="headerlink" title="5.2代码开发"></a>5.2代码开发</h3><p>批量删除代码</p>
<p><code>Controller</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除菜品和对应的口味</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    dishService.deleteWithFlavor(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;菜品数据删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Service</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除对应的菜品信息， 同时还要删除关联表dish_flavor中的数据。</span></span><br><span class="line"><span class="comment">     * 注意：如果菜品为起售则不能删除菜品，只有先停售后才能删除。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteWithFlavor</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="comment">//先来查询菜品状态，确定是否可以删除</span></span><br><span class="line">        <span class="comment">//select count(*) from dish where id in(1,2,3) and status = 1</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.in(Dish::getId,ids);</span><br><span class="line">        queryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//如果不能删除，抛出一个业务异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;菜品正在售卖中，不能删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果可以删除，先删除套餐表中的数据——dish</span></span><br><span class="line">        <span class="built_in">this</span>.removeByIds(ids);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除关系表中的数据——dish_flavor</span></span><br><span class="line">        <span class="comment">//delete from dish_flavor where dish_id in(1,2,3)</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lambdaQueryWrapper.in(DishFlavor::getDishId,ids);</span><br><span class="line"></span><br><span class="line">        dishFlavorService.remove(lambdaQueryWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3功能测试-2"><a href="#5-3功能测试-2" class="headerlink" title="5.3功能测试"></a>5.3功能测试</h3><h2 id="六、菜品的启售停售"><a href="#六、菜品的启售停售" class="headerlink" title="六、菜品的启售停售"></a>六、菜品的启售停售</h2><h3 id="6-1需求分析-1"><a href="#6-1需求分析-1" class="headerlink" title="6.1需求分析"></a>6.1需求分析</h3><p>当菜品处于启售状态的时候，页面上按钮显示为停售；当菜品处于停售状态的时候，页面上按钮显示为启售，点击之后状态进行更改。</p>
<h3 id="6-2代码开发-1"><a href="#6-2代码开发-1" class="headerlink" title="6.2代码开发"></a>6.2代码开发</h3><p><strong>批量启售停售</strong></p>
<ol>
<li><p>我们同样还是使用批量更新的方法<code>updateBatchById()</code>,接受的是一个<code>Dish</code>集合，而不是单单的<code>id</code>。以为需要根据实体类匹配数据库字段，更新每个<code>Dish</code>对象的值。</p>
</li>
<li><p>我们得到的<code>id</code>需要设置给每个<code>Dish</code>对象，并修改状态信息。</p>
</li>
<li><p>路径参数传过来的<code>st</code>，就是要修改的状态值，即我要让这些<code>ids</code>停售，<code>st = 0</code>，所以直接设置状态即可。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;st&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@PathVariable</span> Integer st, <span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.in(Dish::getId,ids);</span><br><span class="line">    List&lt;Dish&gt; dishList = dishService.list(queryWrapper);</span><br><span class="line">    dishList = dishList.stream().map((item) -&gt; &#123;</span><br><span class="line">        item.setStatus(st);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    dishService.updateBatchById(dishList);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;菜品起售停售修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3功能测试-1"><a href="#6-3功能测试-1" class="headerlink" title="6.3功能测试"></a>6.3功能测试</h3><h1 id="业务开发——套餐管理"><a href="#业务开发——套餐管理" class="headerlink" title="业务开发——套餐管理"></a>业务开发——套餐管理</h1><h2 id="一、新增套餐"><a href="#一、新增套餐" class="headerlink" title="一、新增套餐"></a>一、新增套餐</h2><h3 id="1-1需求分析"><a href="#1-1需求分析" class="headerlink" title="1.1需求分析"></a>1.1需求分析</h3><p>套餐就是菜品的集合。</p>
<p>后台系统中可以管理套餐信息，通过新增套餐功能来添加一个新的套餐，在添加套餐时需要选择当前套餐所属的套餐分类和包含的菜品，并且需要上传套餐对应的图片，在移动端会按照套餐分类来展示对应的套餐。</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230127204123515.png" alt="image-20230127204123515"></p>
<h3 id="1-2数据模型"><a href="#1-2数据模型" class="headerlink" title="1.2数据模型"></a>1.2数据模型</h3><p>新增套餐，其实就是将新增页面录入的套餐信息插入到<code>setmeal</code>表，还需要向<code>setmeal_dish</code>表插入套餐和菜品关联数据所以在新增套餐时，涉及到两个表:</p>
<ul>
<li><code>setmeal     </code>                     套餐表</li>
<li><code>setmeal_dish </code>          套餐菜品关系表</li>
</ul>
<h3 id="1-3代码开发"><a href="#1-3代码开发" class="headerlink" title="1.3代码开发"></a>1.3代码开发</h3><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好</p>
<ul>
<li>实体类<code>SetmealDish</code>(直接从课程资料中导入即可，<code>Setmeal</code>实体前面课程中已经导入过了)</li>
<li><code>DTO SetmealDto</code>(直接从课程资料中导入即可)</li>
<li><code>Mapper</code>接口 <code>SetmealDishMapper</code></li>
<li>业务层接口 <code>SetmealDishService</code></li>
<li>业务层实现类 <code>SetmealDishServicelmpl</code></li>
<li>控制层 <code>SetmealController</code></li>
</ul>
<p><strong>梳理交互过程</strong></p>
<p>在开发代码之前，需要梳理一下新增套餐时前端页面和服务端的交互过程</p>
<ol>
<li>页面(backend&#x2F;page&#x2F;combo&#x2F;add.html)发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中（菜品已经实现）</li>
<li>页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中（菜品已经实现）</li>
<li>页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中</li>
<li>页面发送请求进行图片上传，请求服务端将图片保存到服务器（已完成）</li>
<li>页面发送请求进行图片下载，将上传的图片进行回显（已完成）</li>
<li>点击保存按钮，发送ajax请求，将套餐相关数据以<code>json</code> 形式提交到服务端</li>
</ol>
<p>开发新增套餐功能，其实就是在服务端编写代码去处理前端页面发送的这6次请求即可</p>
<p>③ 页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 套餐管理中添加菜品时进行显示</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">       <span class="comment">//构造查询条件对象</span></span><br><span class="line">       LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">       <span class="comment">//添加条件，查询状态为1（启售）</span></span><br><span class="line">       queryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line">       <span class="comment">//添加排序条件</span></span><br><span class="line">       queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">       List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(list);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>⑥ 点击保存按钮，发送ajax请求，将套餐相关数据以<code>json</code> 形式提交到服务端</p>
<p>在service层添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐，同时保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">        <span class="comment">//保存套餐的基本信息，操作setmeal，执行insert操作</span></span><br><span class="line">        <span class="built_in">this</span>.save(setmealDto);</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">        setmealDishes.stream().map((item) -&gt; &#123;</span><br><span class="line">            item.setSetmealId(setmealDto.getId());</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//保存套餐和菜品的关联信息，操作setmeal_dish，执行insert操作</span></span><br><span class="line">        setmealDishService.saveBatch(setmealDishes);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在controller层调用该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 新增套餐</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">       setmealService.saveWithDish(setmealDto);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(<span class="string">&quot;新增套餐成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4功能测试"><a href="#1-4功能测试" class="headerlink" title="1.4功能测试"></a>1.4功能测试</h3><h2 id="二、套餐信息分页查询"><a href="#二、套餐信息分页查询" class="headerlink" title="二、套餐信息分页查询"></a>二、套餐信息分页查询</h2><h3 id="2-1需求分析-2"><a href="#2-1需求分析-2" class="headerlink" title="2.1需求分析"></a>2.1需求分析</h3><p>系统中套餐信息较多，如果在一个页面中进行展示会比较乱，因此采用分页的方式来进行列表数据。</p>
<h3 id="2-2代码开发"><a href="#2-2代码开发" class="headerlink" title="2.2代码开发"></a>2.2代码开发</h3><p><strong>梳理交互过程</strong></p>
<ol>
<li>页面(backend&#x2F;page&#x2F;combo&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize.name)提交到服务端，获取分页数据</li>
<li>页面发送请求，请求服务端进行图片下载，用于页面图片展示</li>
</ol>
<p>开发套餐信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 套餐分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">        <span class="comment">//分页构造器对象</span></span><br><span class="line">        Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">        Page&lt;SetmealDto&gt; dtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//添加查询条件，根据name进行模糊查询</span></span><br><span class="line">        queryWrapper.like(name != <span class="literal">null</span>,Setmeal::getName,name);</span><br><span class="line">        <span class="comment">//添加排序条件，根据更新时间降序排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        setmealService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对象拷贝，由于泛型不一致，因此不需要拷贝records</span></span><br><span class="line">        BeanUtils.copyProperties(pageInfo,dtoPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line">        List&lt;Setmeal&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDto&gt; list = records.stream().map((item) -&gt; &#123;</span><br><span class="line">            <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">            BeanUtils.copyProperties(item,setmealDto);</span><br><span class="line">            <span class="comment">//分类id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();</span><br><span class="line">            <span class="comment">//根据分类id查询分类对象</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//分类名称</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                setmealDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> setmealDto;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        dtoPage.setRecords(list);</span><br><span class="line">        <span class="keyword">return</span> R.success(dtoPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3功能测试"><a href="#2-3功能测试" class="headerlink" title="2.3功能测试"></a>2.3功能测试</h3><p>测试分页查询功能是否正常</p>
<h2 id="三、删除套餐"><a href="#三、删除套餐" class="headerlink" title="三、删除套餐"></a>三、删除套餐</h2><h3 id="3-1需求分析-3"><a href="#3-1需求分析-3" class="headerlink" title="3.1需求分析"></a>3.1需求分析</h3><p>在套餐管理列表页面点击删除按钮，可以删除对应的套餐信息。也可以通过复选框选择多个套餐，点击批量删除按钮一次删除多个套餐。注意，对于状态为售卖中的套餐不能删除，需要先停售，然后才能删除。</p>
<h3 id="3-2代码开发-2"><a href="#3-2代码开发-2" class="headerlink" title="3.2代码开发"></a>3.2代码开发</h3><p><strong>梳理删除套餐时前端页面和服务端的交互过程</strong></p>
<ul>
<li><p>删除单个套餐时，页面发送ajax请求，根据套餐id删除对应套餐</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128101150436.png" alt="image-20230128101150436"></p>
</li>
<li><p>删除多个套餐时，页面发送ajax请求，根据提交的多个套餐id删除对应套餐</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128101234984.png" alt="image-20230128101234984"></p>
</li>
</ul>
<p>开发删除套餐功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可</p>
<p>观察删除单个套餐和批量删除套餐的请求信息可以发现，两种请求的<strong>地址</strong>和<strong>请求方式</strong>都是相同的，不同的则是传递的id个数，所以在服务端可以提供一个方法来统一处理。</p>
<p><code>Controller</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除套餐</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@DeleteMapping</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       setmealService.removeWithDish(ids);</span><br><span class="line">       <span class="keyword">return</span> R.success(<span class="string">&quot;套餐数据删除成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><code>Service</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除套餐，同时删除套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeWithDish</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">       <span class="comment">//先来查询套餐状态，确定是否可以删除</span></span><br><span class="line">       <span class="comment">//select count(*) from setmeal where id in(1,2,3) and status = 1</span></span><br><span class="line">       LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.in(Setmeal::getId,ids);</span><br><span class="line">       queryWrapper.eq(Setmeal::getStatus,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.count(queryWrapper);</span><br><span class="line">       <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">//如果不能删除，抛出一个业务异常</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;套餐正在售卖中，不能删除&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//如果可以删除，先删除套餐表中的数据——setmeal</span></span><br><span class="line">       <span class="built_in">this</span>.removeByIds(ids);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//删除关系表中的数据——setmeal_dish</span></span><br><span class="line">       <span class="comment">//delete from setmeal_dish where setmeal_id in(1,2,3)</span></span><br><span class="line">       LambdaQueryWrapper&lt;SetmealDish&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       lambdaQueryWrapper.in(SetmealDish::getId,ids);</span><br><span class="line"></span><br><span class="line">       setmealDishService.remove(lambdaQueryWrapper);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3功能测试-2"><a href="#3-3功能测试-2" class="headerlink" title="3.3功能测试"></a>3.3功能测试</h3><h2 id="四、套餐的启售停售"><a href="#四、套餐的启售停售" class="headerlink" title="四、套餐的启售停售"></a>四、套餐的启售停售</h2><h3 id="4-1需求分析-3"><a href="#4-1需求分析-3" class="headerlink" title="4.1需求分析"></a>4.1需求分析</h3><p>当菜品处于启售状态的时候，页面上按钮显示为停售；当菜品处于停售状态的时候，页面上按钮显示为启售，点击之后状态进行更改。</p>
<h3 id="4-2代码开发-3"><a href="#4-2代码开发-3" class="headerlink" title="4.2代码开发"></a>4.2代码开发</h3><p>代码和菜品的启售停售类似</p>
<p><code>Controller</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 批量更新启售停售</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> st</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/status/&#123;st&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">setStatus</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> st, String ids)</span>&#123;</span><br><span class="line">       <span class="comment">//处理string 转成Long</span></span><br><span class="line">       String[] split = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">       List&lt;Long&gt; idList = Arrays.stream(split).map(s -&gt; Long.parseLong(s.trim())).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//将每个id new出来一个Setmeal对象，并设置状态</span></span><br><span class="line">       List&lt;Setmeal&gt; setmeals = idList.stream().map((item) -&gt; &#123;</span><br><span class="line">           <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">           setmeal.setId(item);</span><br><span class="line">           setmeal.setStatus(st);</span><br><span class="line">           <span class="keyword">return</span> setmeal;</span><br><span class="line">       &#125;).collect(Collectors.toList()); <span class="comment">//Dish集合</span></span><br><span class="line"></span><br><span class="line">       log.info(<span class="string">&quot;status ids : &#123;&#125;&quot;</span>,ids);</span><br><span class="line">       setmealService.updateBatchById(setmeals);<span class="comment">//批量操作</span></span><br><span class="line">       <span class="keyword">return</span> R.success(<span class="string">&quot;操作成功&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3功能测试-3"><a href="#4-3功能测试-3" class="headerlink" title="4.3功能测试"></a>4.3功能测试</h3><h1 id="业务开发——手机验证码"><a href="#业务开发——手机验证码" class="headerlink" title="业务开发——手机验证码"></a>业务开发——手机验证码</h1><h2 id="一、短信发送"><a href="#一、短信发送" class="headerlink" title="一、短信发送"></a>一、短信发送</h2><h3 id="1-1短信服务介绍"><a href="#1-1短信服务介绍" class="headerlink" title="1.1短信服务介绍"></a>1.1短信服务介绍</h3><p>目前市面上有很多第三方提供的短信服务，这些第三方短信服务会和各个运营商(移动、联通、电信)对接，我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是，这些短信服务一般都是收费服务。</p>
<p>常用短信服务:</p>
<ul>
<li>阿里云</li>
<li>华为云</li>
<li>腾讯云</li>
<li>京东</li>
<li>梦网</li>
<li>乐信</li>
</ul>
<h3 id="1-2阿里云短信服务"><a href="#1-2阿里云短信服务" class="headerlink" title="1.2阿里云短信服务"></a>1.2阿里云短信服务</h3><p>阿里云短信服务(Short Message Service)是广大企业客户快速触达手机用户所优选使用的通信能力。调用API或用群发助手，即可发送验证码、通知类和营销类短信;国内验证短信秒级触达，到达率最高可达99%，国际&#x2F;港澳台短信覆盖200多个国家和地区，安全稳定，广受出海企业选用。</p>
<p>应用场景:</p>
<ul>
<li>验证码</li>
<li>短信通知</li>
<li>推广短信</li>
</ul>
<p><strong>注册账号</strong></p>
<p>阿里云官网：<a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a></p>
<p>注册账号之后<strong>设置短信签名</strong>，短信签名指的是短信发送者的署名，表示发送者身份</p>
<p><strong>模板管理</strong></p>
<h3 id="1-3代码开发-1"><a href="#1-3代码开发-1" class="headerlink" title="1.3代码开发"></a>1.3代码开发</h3><p>使用阿里云短信服务发送短信，可以参照官方文档即可</p>
<p>具体开发步骤：</p>
<ol>
<li><p>导入maven坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--阿里云短信服务--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用API</p>
<ul>
<li>项目资料中已经创建好了 <code>SMSUtils</code></li>
</ul>
</li>
</ol>
<h2 id="二、手机验证码登录"><a href="#二、手机验证码登录" class="headerlink" title="二、手机验证码登录"></a>二、手机验证码登录</h2><h3 id="2-1需求分析-3"><a href="#2-1需求分析-3" class="headerlink" title="2.1需求分析"></a>2.1需求分析</h3><p>为了方便用户登录，移动端通常都会提供通过手机验证码登录的功能</p>
<p><strong>手机验证码登录的优点</strong></p>
<ul>
<li>方便快捷，无需注册，直接登录</li>
<li>使用短信验证码作为登录凭证，无需记忆密码</li>
<li>安全</li>
</ul>
<p><strong>登录流程</strong></p>
<p>输入手机号&gt;获取验证码&gt;输入验证码&gt;点击登录&gt;登录成功</p>
<p><strong>注意</strong>:通过手机验证码登录，手机号是区分不同用户的标识。</p>
<h3 id="2-2数据模型-2"><a href="#2-2数据模型-2" class="headerlink" title="2.2数据模型"></a>2.2数据模型</h3><p>通过手机验证码登录时，涉及的表为<code>user</code>，即用户表。表结构如下：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128181306151.png" alt="image-20230128181306151"></p>
<h3 id="2-3代码开发-2"><a href="#2-3代码开发-2" class="headerlink" title="2.3代码开发"></a>2.3代码开发</h3><p>在开发代码之前，需要梳理一下登录时前端页面和服务端的<strong>交互过程</strong></p>
<ol>
<li>在登录页面(front&#x2F;page&#x2F;login.html)输入手机号，点击 <strong>[获取验证码]</strong> 按钮，页面发送ajax请求，在服务端调用短信服务API给指定手机号发送验证码短信</li>
<li>在登录页面输入验证码，点击**[登录]** 按钮，发送ajax请求，在服务端处理登录请求</li>
</ol>
<p>开发手机验证码登录功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可</p>
<p><strong>开发代码前的准备工作：</strong></p>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好</p>
<ul>
<li>实体类 <code>User</code> (直接从课程资料中导入即可)</li>
<li><code>Mapper</code>接口 <code>UserMapper</code></li>
<li>业务层接口 <code>UserService</code></li>
<li>业务层实现类  <code>UserServicelmpl</code></li>
<li>控制层 <code>UserController</code></li>
<li>工具类<code>SMSUtils</code>、<code>ValidateCodeUtils</code> (直接从课程资料中导入即可)</li>
</ul>
<p><strong>修改<code>LoginCheckFilter</code>过滤器：</strong></p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230128202347907.png" alt="image-20230128202347907"></p>
<p><strong>在<code>LoginCheckFilter</code>中扩展逻辑，修改移动端的用户登录状态</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4-2、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line"><span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">    log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    BaseContext.setCurrentId(userId);</span><br><span class="line"></span><br><span class="line">    filterChain.doFilter(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>资料中给的前端代码有问题，在使用移动端发送**<code>发送验证码</code>**请求的时候，页面直接填充验证码，不发请求，解决办法参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39123467/article/details/127066612">这里</a></li>
</ul>
<p><strong>发送验证码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送手机短信验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//获取手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(phone))&#123;</span><br><span class="line">            <span class="comment">//生成随机的4位验证码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">            log.info(<span class="string">&quot;code=&#123;&#125;&quot;</span>,code);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//调用阿里云提供的短信服务API完成发送短信</span></span><br><span class="line">            <span class="comment">//SMSUtils.sendMessage(&quot;瑞吉外卖&quot;,&quot;&quot;,phone,code);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//需要将生成的验证码保存到Session</span></span><br><span class="line">            session.setAttribute(phone,code);</span><br><span class="line"><span class="comment">//            session.setAttribute(&quot;code&quot;,code);</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(<span class="string">&quot;手机验证码短信发送成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;短信发送失败&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>登录</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 移动端用户登录</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span>&#123;</span><br><span class="line">       log.info(map.toString());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取手机号</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取验证码</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//从Session中获取保存的验证码</span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//进行验证码的比对（页面提交的验证码和Session中保存的验证码比对）</span></span><br><span class="line">       <span class="keyword">if</span>(codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code))&#123;</span><br><span class="line">           <span class="comment">//如果能够比对成功，说明登录成功</span></span><br><span class="line"></span><br><span class="line">           LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">           queryWrapper.eq(User::getPhone,phone);</span><br><span class="line"></span><br><span class="line">           <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line">           <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="comment">//判断当前手机号对应的用户是否为新用户，如果是新用户就自动完成注册</span></span><br><span class="line">               user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">               user.setPhone(phone);</span><br><span class="line">               user.setStatus(<span class="number">1</span>);</span><br><span class="line">               userService.save(user);</span><br><span class="line">           &#125;</span><br><span class="line">           session.setAttribute(<span class="string">&quot;user&quot;</span>,user.getId());</span><br><span class="line">           <span class="keyword">return</span> R.success(user);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4功能测试-2"><a href="#2-4功能测试-2" class="headerlink" title="2.4功能测试"></a>2.4功能测试</h3><h1 id="业务开发——移动端开发"><a href="#业务开发——移动端开发" class="headerlink" title="业务开发——移动端开发"></a>业务开发——移动端开发</h1><h2 id="一、导入用户地址簿"><a href="#一、导入用户地址簿" class="headerlink" title="一、导入用户地址簿"></a>一、导入用户地址簿</h2><h3 id="1-1需求分析-1"><a href="#1-1需求分析-1" class="headerlink" title="1.1需求分析"></a>1.1需求分析</h3><p>地址簿，指的是移动端消费者用户的地址信息，用户登录成功之后可以维护自己的地址信息。同一个用户可以有多个地址信息，但是只有一个<strong>默认地址</strong>。</p>
<p>可以完成功能有</p>
<ul>
<li>保存地址</li>
<li>设置为默认地址</li>
<li>新增地址或者删除地址</li>
</ul>
<h3 id="1-2数据模型-1"><a href="#1-2数据模型-1" class="headerlink" title="1.2数据模型"></a>1.2数据模型</h3><p>用户的地址信息会存储在<code>address_book</code>表，即地址簿表中，具体表结构如下：</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129082947113.png" alt="image-20230129082947113"></p>
<h3 id="1-3导入功能代码"><a href="#1-3导入功能代码" class="headerlink" title="1.3导入功能代码"></a>1.3导入功能代码</h3><p>功能代码清单:</p>
<ul>
<li>实体类 <code>AddressBook</code>(直接从课程资料中导入即可)</li>
<li><code>Mapper</code>接口 <code>AddressBookMapper</code></li>
<li>业务层接口 <code>AddressBookService</code></li>
<li>业务层实现类 <code>AddressBookServicelmpl</code></li>
<li>控制层 <code>AddressBookController </code>(直接从课程资料中导入即可）</li>
</ul>
<p>控制层代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 地址簿管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/addressBook&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">        addressBookService.save(addressBook);</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置默认地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">        LambdaUpdateWrapper&lt;AddressBook&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">        wrapper.set(AddressBook::getIsDefault, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//SQL:update address_book set is_default = 0 where user_id = ?</span></span><br><span class="line">        addressBookService.update(wrapper);</span><br><span class="line"></span><br><span class="line">        addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//SQL:update address_book set is_default = 1 where id = ?</span></span><br><span class="line">        addressBookService.updateById(addressBook);</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (addressBook != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询默认地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">        queryWrapper.eq(AddressBook::getIsDefault, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == addressBook) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询指定用户的全部地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//条件构造器</span></span><br><span class="line">        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="literal">null</span> != addressBook.getUserId(), AddressBook::getUserId, addressBook.getUserId());</span><br><span class="line">        queryWrapper.orderByDesc(AddressBook::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SQL:select * from address_book where user_id = ? order by update_time desc</span></span><br><span class="line">        <span class="keyword">return</span> R.success(addressBookService.list(queryWrapper));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-4功能测试-1"><a href="#1-4功能测试-1" class="headerlink" title="1.4功能测试"></a>1.4功能测试</h3><h2 id="二、菜品展示"><a href="#二、菜品展示" class="headerlink" title="二、菜品展示"></a>二、菜品展示</h2><h3 id="2-1需求分析-4"><a href="#2-1需求分析-4" class="headerlink" title="2.1需求分析"></a>2.1需求分析</h3><p>用户登陆成功后跳转系统首页，在首页需要根据分类来展示菜品和套餐。如果菜品设置了口味信息，需要展示【选择规格】按钮，否则展示【+】按钮</p>
<h3 id="2-2代码开发-1"><a href="#2-2代码开发-1" class="headerlink" title="2.2代码开发"></a>2.2代码开发</h3><p><strong>梳理交互过程</strong></p>
<p>在开发代码之前，需要梳理一下前端页面和服务端的交互过程</p>
<ol>
<li>页面(front&#x2F;index.html)发送ajax请求，获取分类数据 (菜品分类和套餐分类)</li>
<li>页面发送ajax请求，获取第一个分类下的菜品或者套餐</li>
</ol>
<p>开发菜品展示功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>注意：首页加载完成后，还发送了一次ajax请求用于加载购物车数据，此处可以将这次请求的地址暂时修改一下，从静态<code>json</code>文件获取数据，等后续开发购物车功能时再修改回来，如下:</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129094615009.png" alt="image-20230129094615009"></p>
<p><strong>首先在菜品有口味信息的时候，显示按钮为选择规格，因此需要修改<code>DishController</code>中的list方法追加口味信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">       <span class="comment">//构造查询条件对象</span></span><br><span class="line">       LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">       <span class="comment">//添加条件，查询状态为1（启售）</span></span><br><span class="line">       queryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line">       <span class="comment">//添加排序条件</span></span><br><span class="line">       queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">       List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">       List&lt;DishDto&gt; dishDtoList = list.stream().map((item) -&gt; &#123;</span><br><span class="line">           <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">           BeanUtils.copyProperties(item,dishDto);</span><br><span class="line"></span><br><span class="line">           <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();<span class="comment">//分类id</span></span><br><span class="line">           <span class="comment">//根据id查询分类对象</span></span><br><span class="line">           <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>(category != <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">               dishDto.setCategoryName(categoryName);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">//当前菜品的id</span></span><br><span class="line">           <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> item.getId();</span><br><span class="line">           LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">           lambdaQueryWrapper.eq(DishFlavor::getDishId,dishId);</span><br><span class="line">           <span class="comment">//select * from dish_flavor where dish_id = ?</span></span><br><span class="line">           List&lt;DishFlavor&gt; dishFlavorList = dishFlavorService.list(lambdaQueryWrapper);</span><br><span class="line">           dishDto.setFlavors(dishFlavorList);</span><br><span class="line">           <span class="keyword">return</span> dishDto;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>此时可以显示菜品相关信息，现在来写显示套餐的相关信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据条件查询套餐数据</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>&#123;</span><br><span class="line">       LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.eq(setmeal.getCategoryId() != <span class="literal">null</span>,Setmeal::getCategoryId,setmeal.getCategoryId());</span><br><span class="line">       queryWrapper.eq(setmeal.getStatus() != <span class="literal">null</span>,Setmeal::getStatus,setmeal.getStatus());</span><br><span class="line">       queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">       List&lt;Setmeal&gt; list = setmealService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(list);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3功能测试-1"><a href="#2-3功能测试-1" class="headerlink" title="2.3功能测试"></a>2.3功能测试</h3><h2 id="三、购物车"><a href="#三、购物车" class="headerlink" title="三、购物车"></a>三、购物车</h2><h3 id="3-1需求分析-4"><a href="#3-1需求分析-4" class="headerlink" title="3.1需求分析"></a>3.1需求分析</h3><p>移动端用户可以将菜品或者套餐添加到购物车。对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车;对于套餐来说，可以直接点击【+】将当前套餐加入购物车。在购物车中可以修改菜品和套餐的数量也可以清空购物车。</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129105125929.png" alt="image-20230129105125929"></p>
<h3 id="3-2数据模型-1"><a href="#3-2数据模型-1" class="headerlink" title="3.2数据模型"></a>3.2数据模型</h3><p>购物车对应的数据表为<code>shopping_cart</code>表，具体的表结构为</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230129105944178.png" alt="image-20230129105944178"></p>
<h3 id="3-3代码开发-1"><a href="#3-3代码开发-1" class="headerlink" title="3.3代码开发"></a>3.3代码开发</h3><p>在开发代码之前，需要梳理一下购物车操作时前端页面和服务端的交互过程</p>
<ol>
<li>点击【加入购物车】或者【+】按钮，页面发送ajax请求，请求服务端，将菜品或者套餐添加到购物车</li>
<li>点击购物车图标，页面发送ajax请求，请求服务端查询购物车中的菜品和套餐</li>
<li>点击清空购物车按钮，页面发送ajax请求，请求服务端来执行清空购物车操作</li>
</ol>
<p>开发购物车功能，其实就是在服务端编写代码去处理前端页面发送的这3次请求即可</p>
<p><strong>准备工作</strong></p>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好</p>
<ul>
<li>实体类 <code>ShoppingCart</code> (直接从课程资料中导入即可)</li>
<li><code>Mapper</code>接口 <code>ShoppingCartMapper</code></li>
<li>业务层接口 <code>ShoppingCartService</code></li>
<li>业务层实现类 <code>ShoppingCartServicelmpl</code></li>
<li>控制层 <code>ShoppingCartController</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/shoppingCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;ShoppingCart&gt; <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;购物车数据:&#123;&#125;&quot;</span>,shoppingCart);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置用户id，指定当前是哪个用户的购物车数据</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        shoppingCart.setUserId(currentId);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId,currentId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(dishId != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//添加到购物车的是菜品</span></span><br><span class="line">            queryWrapper.eq(ShoppingCart::getDishId,dishId);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//添加到购物车的是套餐</span></span><br><span class="line">            queryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询当前菜品或者套餐是否在购物车中</span></span><br><span class="line">        <span class="comment">//SQL:select * from shopping_cart where user_id = ? and dish_id/setmeal_id = ?</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cartServiceOne</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(cartServiceOne != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//如果已经存在，就在原来数量基础上加一</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> cartServiceOne.getNumber();</span><br><span class="line">            cartServiceOne.setNumber(number + <span class="number">1</span>);</span><br><span class="line">            shoppingCartService.updateById(cartServiceOne);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//如果不存在，则添加到购物车，数量默认就是一</span></span><br><span class="line">            shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">            shoppingCartService.save(shoppingCart);</span><br><span class="line">            cartServiceOne = shoppingCart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(cartServiceOne);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;查看购物车...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId,BaseContext.getCurrentId());</span><br><span class="line">        queryWrapper.orderByAsc(ShoppingCart::getCreateTime);</span><br><span class="line"></span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//SQL:delete from shopping_cart where user_id = ?</span></span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId, BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        shoppingCartService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;清空购物车成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4功能测试-1"><a href="#3-4功能测试-1" class="headerlink" title="3.4功能测试"></a>3.4功能测试</h3><h2 id="四、用户下单"><a href="#四、用户下单" class="headerlink" title="四、用户下单"></a>四、用户下单</h2><h3 id="4-1需求分析-4"><a href="#4-1需求分析-4" class="headerlink" title="4.1需求分析"></a>4.1需求分析</h3><p>移动端用户将菜品或者套餐加入到购物车之后，可以点击购物车中的【去结算】按钮，页面跳转到订单确认页面，点击【去支付】按钮完成下单操作。</p>
<ul>
<li>在这里只完成结算显示订单功能，支付需要相关资质才可以，目前不考虑</li>
</ul>
<h3 id="4-2数据模型"><a href="#4-2数据模型" class="headerlink" title="4.2数据模型"></a>4.2数据模型</h3><p>用户下单业务对应的数据表为<code>orders</code>表和<code>order_detail</code>表：</p>
<ul>
<li><p><code>orders</code>表：订单表</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230202164857980.png" alt="image-20230202164857980"></p>
</li>
<li><p><code>order_detail</code>表：订单明细表</p>
<p><img src="/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/image-20230202164654592.png" alt="image-20230202164654592"></p>
<ul>
<li>name指菜品的名字</li>
</ul>
</li>
</ul>
<h3 id="4-3代码开发"><a href="#4-3代码开发" class="headerlink" title="4.3代码开发"></a>4.3代码开发</h3><p><strong>梳理交互过程</strong></p>
<ol>
<li>在购物车中点击【去结算】按钮，页面跳转到订单确认页面</li>
<li>在订单确认页面，发送<code>ajax</code>请求，请求服务端获取当前登录用户的默认地址</li>
<li>在订单确认页面，发送<code>ajax</code>请求，请求服务端获取当前登录用户的购物车数据</li>
<li>在订单确认页面点击【去支付】按钮，发送<code>ajax</code>请求，请求服务端完成下单操作</li>
</ol>
<p>开发用户下单功能，其实就是在服务端编写代码去处理前端页面发送的请求即可</p>
<p><strong>准备工作</strong></p>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好：</p>
<ul>
<li>实体类<code>Orders</code>、<code>OrderDetails</code>(直接从课程资料中进行导入)</li>
<li><code>Mapper</code>接口<code>OrderMapper</code>、<code>OrderDetailMappper</code></li>
<li>业务层接口<code>OrderService</code>、<code>OrderDetailService</code></li>
<li>业务层实现类<code>OrderServiceImpl</code>、<code>OrderDetailServiceImpl</code></li>
<li>控制层<code>OrderController</code>、<code>OrderDetailController</code></li>
</ul>
<p><strong>代码实现</strong></p>
<ul>
<li>在<code>OrderController</code>控制层中，将下单操作封装在<code>orderService</code>方法中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 用户下单功能</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> Orders orders)</span> &#123;</span><br><span class="line">       log.info(<span class="string">&quot;订单数据：&#123;&#125;&quot;</span>,orders);</span><br><span class="line">       orderService.submit(orders);</span><br><span class="line">       <span class="keyword">return</span> R.success(<span class="string">&quot;下单成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>OrderService</code>方法中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> OrderDetailService orderDetailService;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 用户下单</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">       <span class="comment">//首先获取当前用户的id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询当前用户的购物车数据</span></span><br><span class="line">       LambdaQueryWrapper&lt;ShoppingCart&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       wrapper.eq(ShoppingCart::getUserId,userId);</span><br><span class="line">       List&lt;ShoppingCart&gt; shoppingCarts = shoppingCartService.list(wrapper);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (shoppingCarts == <span class="literal">null</span> || shoppingCarts.size() == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;购物车为空，不能下单&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//查询用户数据</span></span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//地址数据</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">addressBookId</span> <span class="operator">=</span> orders.getAddressBookId();</span><br><span class="line">       <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(addressBookId);</span><br><span class="line">       <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;用户地址信息有误，不能下单&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> IdWorker.getId();<span class="comment">//订单号</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//原子操作，保证多线程也可以计算成功</span></span><br><span class="line">       <span class="type">AtomicInteger</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//1.计算总金额 2.订单明细</span></span><br><span class="line">       List&lt;OrderDetail&gt; orderDetails = shoppingCarts.stream().map((item) -&gt; &#123;</span><br><span class="line">           <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">           orderDetail.setOrderId(orderId);</span><br><span class="line">           orderDetail.setNumber(item.getNumber());</span><br><span class="line">           orderDetail.setDishFlavor(item.getDishFlavor());</span><br><span class="line">           orderDetail.setDishId(item.getDishId());</span><br><span class="line">           orderDetail.setSetmealId(item.getSetmealId());</span><br><span class="line">           orderDetail.setName(item.getName());</span><br><span class="line">           orderDetail.setImage(item.getImage());</span><br><span class="line">           orderDetail.setAmount(item.getAmount());</span><br><span class="line">           amount.addAndGet(item.getAmount().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(item.getNumber())).intValue());</span><br><span class="line">           <span class="keyword">return</span> orderDetail;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       orders.setId(orderId);</span><br><span class="line">       orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">       orders.setCheckoutTime(LocalDateTime.now());</span><br><span class="line">       orders.setStatus(<span class="number">2</span>);</span><br><span class="line">       orders.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amount.get()));<span class="comment">//总金额</span></span><br><span class="line">       orders.setUserId(userId);</span><br><span class="line">       orders.setNumber(String.valueOf(orderId));</span><br><span class="line">       orders.setUserName(user.getName());</span><br><span class="line">       orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">       orders.setPhone(addressBook.getPhone());</span><br><span class="line">       orders.setAddress((addressBook.getProvinceName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getProvinceName())</span><br><span class="line">               + (addressBook.getCityName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getCityName())</span><br><span class="line">               + (addressBook.getDistrictName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDistrictName())</span><br><span class="line">               + (addressBook.getDetail() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDetail()));</span><br><span class="line">       <span class="comment">//向订单表插入数据，一条数据</span></span><br><span class="line">       <span class="built_in">this</span>.save(orders);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//向订单明细表插入数据，多条数据</span></span><br><span class="line">       orderDetailService.saveBatch(orderDetails);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//清空购物车数据</span></span><br><span class="line">       shoppingCartService.remove(wrapper);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-4功能测试"><a href="#4-4功能测试" class="headerlink" title="4.4功能测试"></a>4.4功能测试</h3><p>测试功能是否完善</p>
<h1 id="BUG汇总"><a href="#BUG汇总" class="headerlink" title="BUG汇总"></a>BUG汇总</h1><ol>
<li>在2.3.2中对登录功能进行完善的模块，由于后台管理系统和客户端不同时开发的。在开发客户端时，直接将登录过滤器加在了后台系统的后面。这就导致如果用户进行了登录，那么它也可以不登录即访问后台管理系统。</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Sun Peiyuan
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://spy955.github.io/2023/03/09/02-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91/" title="瑞吉外卖业务开发">https://spy955.github.io/2023/03/09/02-瑞吉外卖业务开发/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/03/09/01-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/" rel="prev" title="瑞吉外卖项目介绍">
                  <i class="fa fa-chevron-left"></i> 瑞吉外卖项目介绍
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/03/09/03-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/" rel="next" title="瑞吉外卖项目优化">
                  瑞吉外卖项目优化 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">



<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sun Peiyuan</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">190k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:52</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>
-->





    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






  
  <script type="text/javascript"
  color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>


